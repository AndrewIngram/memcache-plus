<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="assets/style.css?t=a44c9e9d">
    <script src="assets/script.js?t=2bcc4b59"></script>
    <title>Miscellaneous</title>
    <meta name="viewport" content="width=device-width">
  </head>
  <body class="-menu-visible">
    <div class="doc-layout">
      <div class="toggle menu-toggle js-menu-toggle"></div>
      <div class="body page-misc">
        <div class="header-nav">
          <div class="right">
          </div>
        </div>
        <div class="markdown-body"><h1 id="miscellaneous">Miscellaneous</h1>
<h3 id="why-are-only-key-values-allowed">Why are only key values allowed?</h3>
<h4 id="background">Background</h4>
<p>This is a debate we had when writing this module as we wanted to be able to set
anything (number, null, boolean, string, object, array) and get it back as the
same thing.</p>
<p><em>tl;dr We made the decision to only allow string values as it simplifies things
and maintains maximum interoperability with other libraries/systems.</em></p>
<p>The problem is that, as values are written to Memcache, they are written as just
byte buffers so they lose any of their &quot;type&quot; in the process. So if I write a
number like <code>34.29</code> to Memcache, it will come out as a Buffer containing <code>34.29</code>
but does not have a type. So the library can&apos;t distinguish whether what
originally was set was the number <code>34.29</code> or the string <code>&quot;34.29&quot;</code>.</p>
<p>We made the design decision to enforce the constraint that all things stored are
strings and leave it to the user to deal with the conversions. This way at least
it is consistent.</p>
<h4 id="other-libraries">Other libraries</h4>
<p>Some other Memcache modules will allow users to <code>set()</code> numbers and then return
strings back with <code>get()</code>. So you could do (in pseudocode since obviously the
following wouldn&apos;t work without promises or callbacks):</p>
<pre><code class="lang-javascript"><span class="pl-c">// Set a number</span>
client.set(<span class="pl-s">&apos;myNumber&apos;</span>, <span class="hljs-number">12.54</span>);

<span class="pl-c">// Get back a string</span>
<span class="pl-k">var</span> myNumber = client.get(<span class="pl-s">&apos;myNumber&apos;</span>)

<span class="pl-c1">console</span>.log(<span class="pl-k">typeof</span> myNumber)
<span class="pl-c">// Would print &quot;string&quot;, wtf?</span>
</code></pre>
<p>As you can see this is rather confusing! We think it makes more sense to just
enforce the constraint that all values must be strings, then there is never
confusion.</p>
<h4 id="a-possible-solution">A possible solution</h4>
<p>We have considered taking each value and storing it as a more complex object so
it could be deserialized later.</p>
<p>For instance, instead of writing just the raw value to Memcache, we&apos;d do
something like the following:</p>
<pre><code class="lang-javascript"><span class="pl-c">// Trying to set a number</span>
client.set(<span class="pl-s">&apos;myNumber&apos;</span>, <span class="hljs-number">12.54</span>)

<span class="pl-c">// Would actually do the following under the hood:</span>
client.set(<span class="pl-s">&apos;myNumber&apos;</span>, <span class="pl-c1">JSON</span>.stringify({ type: <span class="pl-s">&apos;number&apos;</span>, value: <span class="hljs-number">12.54</span> });

<span class="pl-c">// This way, when it&apos;s extracted from Memcache, we can reassemble it with the</span>
<span class="pl-c">// correct type</span>
<span class="pl-k">var</span> myNumber = client.get(<span class="pl-s">&apos;myNumber&apos;</span>);

<span class="pl-c1">console</span>.log(<span class="pl-k">typeof</span> myNumber);
<span class="pl-c">// Would print &quot;number&quot; because this library would get back the stringified</span>
<span class="pl-c">// object which was set in Memcache and be able to re-constitute the value to</span>
<span class="pl-c">// the correct type.</span>

<span class="pl-c">// This would also enable things like the following to set and get appropriately:</span>
client.set(<span class="pl-s">&apos;myUser&apos;</span>, { firstName: <span class="pl-s">&apos;Victor&apos;</span>, lastName: <span class="pl-s">&apos;Quinn&apos;</span> });
client.set(<span class="pl-s">&apos;myUser&apos;</span>, [<span class="pl-s">&apos;Harley&apos;</span>, <span class="pl-s">&apos;Kawasaki&apos;</span>, <span class="pl-s">&apos;Triumph&apos;</span>, <span class="pl-s">&apos;BMW&apos;</span>]);
client.set(<span class="pl-s">&apos;myUser&apos;</span>, <span class="hljs-number">5</span>);
client.set(<span class="pl-s">&apos;myUser&apos;</span>, <span class="pl-c1">true</span>);
client.set(<span class="pl-s">&apos;myUser&apos;</span>, <span class="pl-c1">null</span>);
</code></pre>
<p>However, it could break interoperability with other systems as they would expect
to retrieve just a value and instead get back a complex object.</p>
<p>So we&apos;d like to get this enabled for this module at some point in the future as
an option but for now we only allow string values.</p>

        </div>
        <div class="footer-nav">
          <div class="left"><a href="get.html"><span class="title">Get</span></a></div>
        </div>
      </div>
      <div class="menu toc-menu">
        <li class="menu-item -level-0 -parent">
          <ul class="submenu">
            <li class="menu-item -level-1 -parent"><a href="index.html" class="link title  link-index">Memcache Plus</a>
              <ul class="submenu">
                <li class="menu-item -level-2"><a href="intro.html" class="link title  link-intro">Getting Started</a>
                </li>
                <li class="menu-item -level-2"><a href="set.html" class="link title  link-set">Set</a>
                </li>
                <li class="menu-item -level-2"><a href="get.html" class="link title  link-get">Get</a>
                </li>
                <li class="menu-item -level-2"><a href="misc.html" class="link title -active link-misc">Miscellaneous</a>
                  <ul class="headings heading-list">
                    <li class="heading-item -depth-3"><a href="#why-are-only-key-values-allowed" class="hlink link-why-are-only-key-values-allowed">Why are only key values allowed?</a>
                    </li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </li>
      </div>
    </div>
  </body>
</html>